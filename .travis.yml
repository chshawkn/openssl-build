
language: cpp

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -rf $HOME/.gradle/caches/*/plugin-resolution/

#before_install:


branches:
  only:
  - master
  - /^release\/.*$/
  - /^v\d+\.\d+(\.\d+)?(-\S*)?/

cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
  - $HOME/.android/build-cache

deploy:
  provider: releases
  api_key: $GITHUB_GIT_SERVICE_TOKEN
  file_glob: true
  file: target/openssl-1.1.0c-*.tar.gz
  skip_cleanup: true
  on:
    tags: true

env:
  global:
  - LIB_NAME="openssl-1.1.0c"
  - RUST_IOS_ARCHS="aarch64 armv7 armv7s i386 x86_64"
  - RUST_AND_ARCHS="aarch64 armv7 arm i686"

#install:
##- brew cask install android-sdk
#- brew cask install android-ndk
##- rustup target list
#- rustup toolchain install stable-x86_64-apple-darwin
#- rustup target add i686-apple-darwin
#- rustup target add aarch64-linux-android
#- rustup target add arm-linux-androideabi
#- rustup target add armv7-linux-androideabi
#- rustup target add i686-linux-android
#- rustup target add aarch64-apple-ios
#- rustup target add armv7-apple-ios
#- rustup target add armv7s-apple-ios
#- rustup target add i386-apple-ios
#- rustup target add x86_64-apple-ios

#matrix:
#  exclude:

os:
- osx

osx_image: xcode8.3

script:
# before_install
- brew update
- brew tap caskroom/cask
- curl https://sh.rustup.rs -sSf | sh -s -- -y
# install:
- brew cask install android-ndk
- rustup toolchain install stable-x86_64-apple-darwin
- rustup target add i686-apple-darwin
- rustup target add aarch64-linux-android
- rustup target add arm-linux-androideabi
- rustup target add armv7-linux-androideabi
- rustup target add i686-linux-android
- rustup target add aarch64-apple-ios
- rustup target add armv7-apple-ios
- rustup target add armv7s-apple-ios
- rustup target add i386-apple-ios
- rustup target add x86_64-apple-ios
# script
- sh ci.sh
#- cargo build --target=arm-linux-androideabi
